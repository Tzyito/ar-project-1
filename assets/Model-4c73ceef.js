import{d as D,g as _,o as x,c as S,h as R,i as y,v as q}from"./index-f4feb15b.js";import{E as C,V as L,a as j,Q as O,S as A,P,b as T,A as z,c as W,D as k,d as H,e as B,M as V,f as F,g as b,h as G,W as Q,C as U}from"./three.module-b870e4da.js";function g(a){const n=this;this.object=a,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation=null,this.screenOrientation=0,this.alphaOffset=0,this.initialOffset=null;const o=function({alpha:e,beta:i,gamma:r}){n.initialOffset===null&&(n.initialOffset=e),console.log(e,"alpha值"),e=e-n.initialOffset,e<0&&(e+=360),n.deviceOrientation={alpha:e,beta:i,gamma:r}},t=function(){n.screenOrientation=window.orientation||0},d=function(){window.addEventListener("orientationchange",t,!1),window.addEventListener("deviceorientation",o,!1)}.bind(this),m=function(){const e=new L(0,0,1),i=new j,r=new O,u=new O(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(c,f,h,w,l){i.set(h,f,-w,"YXZ"),c.setFromEuler(i),c.multiply(u),c.multiply(r.setFromAxisAngle(e,-l))}}();this.connect=function(){t(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(function(e){e=="granted"&&(console.log("点击确认"),d())}).catch(function(e){console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",e)}):d(),n.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",t,!1),window.removeEventListener("deviceorientation",o,!1),n.enabled=!1,n.deviceOrientation=null,n.initialOffset=null},this.update=function({theta:e=0}={theta:0}){if(n.enabled===!1)return;const i=n.deviceOrientation;if(i){const r=i.alpha?(void 0).degToRad(i.alpha)+n.alphaOffset:0,u=i.beta?(void 0).degToRad(i.beta):0,c=i.gamma?(void 0).degToRad(i.gamma):0,f=n.screenOrientation?(void 0).degToRad(n.screenOrientation):0;m(n.object.quaternion,r+e,u,c,f)}},this.dispose=function(){n.disconnect()},this.getAlpha=function(){const{deviceOrientation:e}=n;return e&&e.alpha?(void 0).degToRad(e.alpha)+n.alphaOffset:0},this.getBeta=function(){const{deviceOrientation:e}=n;return e&&e.beta?(void 0).degToRad(e.beta):0}}g.prototype=Object.assign(Object.create(C.prototype),{constructor:g});const X=async()=>{let a;const n=new U,o=new A,t=new P(75,window.innerWidth/window.innerHeight,.1,1e3);t.position.set(100,100,100),document.querySelector("#container");const d=document.querySelector("#box");document.createElement("video"),console.log("开始初始化摄像头"),await E(),console.log("获取摄像头数据完成,开始播放");const m=new T(document.querySelector("video"));o.background=m;const e=new z(5e3);o.add(e);const i=new W(16777215);o.add(i);const r=new k(16777215,1);r.position.set(5,0,10).normalize(),o.add(r);const u=new H(108,71),c=new B(100,30,30),f=new V({color:"blue",side:F}),h=new b(u,f),w=new b(c,new G({color:"red"}));h.position.set(100,0,400),w.position.set(0,0,0),o.add(h),o.add(w);const l=new Q;l.setSize(window.innerWidth,window.innerHeight),d==null||d.appendChild(l.domElement),a=new g(t),window.addEventListener("resize",M);async function E(){const s=document.querySelector("video");s.srcObject=await Y(s),s.autoplay=!0,s.play(),console.log("获取到视频数据：",s.srcObject)}function M(){t.aspect=window.innerWidth/window.innerHeight,t.updateProjectionMatrix(),l.setSize(window.innerWidth,window.innerHeight)}function p(){requestAnimationFrame(p),a.update(n.getDelta());const{beta:s=null,gamma:v=null}=a.deviceOrientation??{};console.log(s,v,"位置"),!(!s||!v)&&(t.lookAt(0,0,0),t.position.x=-v/90,t.position.y=s/90,t.position.z=1-.5*Math.min(Math.abs(t.position.x)+Math.abs(t.position.y),1),l.render(o,t))}p()},Y=a=>new Promise(async(n,o)=>{console.log("开始打开摄像头");const t=await navigator.mediaDevices.getUserMedia({video:{width:500,height:400,facingMode:"environment"}});t?a?n(t):o(new Error("not find el")):alert("摄像头开启失败")}),Z={id:"container"},I={muted:"","x5-video-player-type":"",autoplay:""},N=y("div",{id:"box"},null,-1),$=D({__name:"Model",setup(a){return _(()=>{X()}),(n,o)=>(x(),S("div",Z,[R(y("video",I,null,512),[[q,!1]]),N]))}});export{$ as default};
