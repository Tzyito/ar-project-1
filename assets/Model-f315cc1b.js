import{d as D,g as _,o as x,c as S,h as R,i as y,v as j}from"./index-601a4a8c.js";import{E as q,V as C,a as L,Q as O,S as A,P,b as T,A as k,c as z,D as W,d as H,e as B,M as V,f as F,g as b,h as G,W as Q,C as U}from"./three.module-b870e4da.js";function g(s){const n=this;this.object=s,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation=null,this.screenOrientation=0,this.alphaOffset=0,this.initialOffset=null;const o=function({alpha:e,beta:i,gamma:r}){n.initialOffset===null&&(n.initialOffset=e),console.log(e,"alpha值"),e=e-n.initialOffset,e<0&&(e+=360),n.deviceOrientation={alpha:e,beta:i,gamma:r}},t=function(){n.screenOrientation=window.orientation||0},a=function(){window.addEventListener("orientationchange",t,!1),window.addEventListener("deviceorientation",o,!1)}.bind(this),m=function(){const e=new C(0,0,1),i=new L,r=new O,u=new O(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(c,f,h,w,d){i.set(h,f,-w,"YXZ"),c.setFromEuler(i),c.multiply(u),c.multiply(r.setFromAxisAngle(e,-d))}}();this.connect=function(){t(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(function(e){e=="granted"&&(console.log("点击确认"),a())}).catch(function(e){console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",e)}):a(),n.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",t,!1),window.removeEventListener("deviceorientation",o,!1),n.enabled=!1,n.deviceOrientation=null,n.initialOffset=null},this.update=function({theta:e=0}={theta:0}){if(n.enabled===!1)return;const i=n.deviceOrientation;if(i){const r=i.alpha?(void 0).degToRad(i.alpha)+n.alphaOffset:0,u=i.beta?(void 0).degToRad(i.beta):0,c=i.gamma?(void 0).degToRad(i.gamma):0,f=n.screenOrientation?(void 0).degToRad(n.screenOrientation):0;m(n.object.quaternion,r+e,u,c,f)}},this.dispose=function(){n.disconnect()},this.getAlpha=function(){const{deviceOrientation:e}=n;return e&&e.alpha?(void 0).degToRad(e.alpha)+n.alphaOffset:0},this.getBeta=function(){const{deviceOrientation:e}=n;return e&&e.beta?(void 0).degToRad(e.beta):0}}g.prototype=Object.assign(Object.create(q.prototype),{constructor:g});const X=async()=>{let s;const n=new U,o=new A,t=new P(75,window.innerWidth/window.innerHeight,.1,1e3);t.position.set(100,100,100),document.querySelector("#container");const a=document.querySelector("#box");document.createElement("video"),console.log("开始初始化摄像头"),await E(),console.log("获取摄像头数据完成,开始播放");const m=new T(document.querySelector("video"));o.background=m;const e=new k(5e3);o.add(e);const i=new z(16777215);o.add(i);const r=new W(16777215,1);r.position.set(5,0,10).normalize(),o.add(r);const u=new H(108,71),c=new B(100,30,30),f=new V({color:"blue",side:F}),h=new b(u,f),w=new b(c,new G({color:"red"}));h.position.set(100,0,400),w.position.set(0,0,0),o.add(h),o.add(w);const d=new Q;d.setSize(window.innerWidth,window.innerHeight),a==null||a.appendChild(d.domElement),s=new g(t),window.addEventListener("resize",M);async function E(){const l=document.querySelector("video");await Y(l),console.log("获取到视频数据：",l.srcObject)}function M(){t.aspect=window.innerWidth/window.innerHeight,t.updateProjectionMatrix(),d.setSize(window.innerWidth,window.innerHeight)}function p(){requestAnimationFrame(p),s.update(n.getDelta());const{beta:l=null,gamma:v=null}=s.deviceOrientation??{};console.log(l,v,s.deviceOrientation,"位置"),!(!l||!v)&&(t.lookAt(0,0,0),t.position.x=-v/90,t.position.y=l/90,t.position.z=1-.5*Math.min(Math.abs(t.position.x)+Math.abs(t.position.y),1),d.render(o,t))}p()},Y=s=>new Promise(async(n,o)=>{console.log("开始打开摄像头");const t=await navigator.mediaDevices.getUserMedia({video:{width:500,height:400,facingMode:"environment"}});if(t)if(!s)o(new Error("not find el"));else{let a=s;a.srcObject=t,console.log(a.srcObject),a.play(),console.log("开始播放")}else alert("摄像头开启失败")}),Z={id:"container"},I={width:"500",height:"400",muted:"",playsinline:"",controls:!1,"webkit-playsinline":"","x5-video-player-type":"",autoplay:""},N=y("div",{id:"box"},null,-1),$=D({__name:"Model",setup(s){return _(async()=>{await X()}),(n,o)=>(x(),S("div",Z,[R(y("video",I,null,512),[[j,!1]]),N]))}});export{$ as default};
