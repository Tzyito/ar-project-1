import{d as M,g as D,o as _,c as x,h as S,i as y,v as R}from"./index-4373cfc0.js";import{E as q,V as C,a as L,Q as O,S as j,P as A,b as P,A as T,c as k,D as z,d as W,e as H,M as B,f as V,g as b,h as F,W as G,C as Q}from"./three.module-b870e4da.js";function g(s){const n=this;this.object=s,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation=null,this.screenOrientation=0,this.alphaOffset=0,this.initialOffset=null;const o=function({alpha:e,beta:i,gamma:r}){n.initialOffset===null&&(n.initialOffset=e),console.log(e,"alpha值"),e=e-n.initialOffset,e<0&&(e+=360),n.deviceOrientation={alpha:e,beta:i,gamma:r}},t=function(){n.screenOrientation=window.orientation||0},a=function(){window.addEventListener("orientationchange",t,!1),window.addEventListener("deviceorientation",o,!1)}.bind(this),w=function(){const e=new C(0,0,1),i=new L,r=new O,l=new O(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(c,u,h,f,d){i.set(h,u,-f,"YXZ"),c.setFromEuler(i),c.multiply(l),c.multiply(r.setFromAxisAngle(e,-d))}}();this.connect=function(){t(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(function(e){e=="granted"&&(console.log("点击确认"),a())}).catch(function(e){console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",e)}):a(),n.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",t,!1),window.removeEventListener("deviceorientation",o,!1),n.enabled=!1,n.deviceOrientation=null,n.initialOffset=null},this.update=function({theta:e=0}={theta:0}){if(n.enabled===!1)return;const i=n.deviceOrientation;if(i){const r=i.alpha?(void 0).degToRad(i.alpha)+n.alphaOffset:0,l=i.beta?(void 0).degToRad(i.beta):0,c=i.gamma?(void 0).degToRad(i.gamma):0,u=n.screenOrientation?(void 0).degToRad(n.screenOrientation):0;w(n.object.quaternion,r+e,l,c,u)}},this.dispose=function(){n.disconnect()},this.getAlpha=function(){const{deviceOrientation:e}=n;return e&&e.alpha?(void 0).degToRad(e.alpha)+n.alphaOffset:0},this.getBeta=function(){const{deviceOrientation:e}=n;return e&&e.beta?(void 0).degToRad(e.beta):0}}g.prototype=Object.assign(Object.create(q.prototype),{constructor:g});const U=async()=>{let s;const n=new Q,o=new j,t=new A(75,window.innerWidth/window.innerHeight,.1,1e3);t.position.set(100,100,100),document.querySelector("#container");const a=document.querySelector("#box");document.createElement("video"),console.log("开始初始化摄像头"),await X(document.querySelector("video")),console.log("获取摄像头数据完成,开始播放");const w=new P(document.querySelector("video"));o.background=w;const e=new T(5e3);o.add(e);const i=new k(16777215);o.add(i);const r=new z(16777215,1);r.position.set(5,0,10).normalize(),o.add(r);const l=new W(108,71),c=new H(100,30,30),u=new B({color:"blue",side:V}),h=new b(l,u),f=new b(c,new F({color:"red"}));h.position.set(100,0,400),f.position.set(0,0,0),o.add(h),o.add(f);const d=new G;d.setSize(window.innerWidth,window.innerHeight),a==null||a.appendChild(d.domElement),s=new g(t),window.addEventListener("resize",E);function E(){t.aspect=window.innerWidth/window.innerHeight,t.updateProjectionMatrix(),d.setSize(window.innerWidth,window.innerHeight)}function p(){requestAnimationFrame(p),s.update(n.getDelta());const{beta:m=null,gamma:v=null}=s.deviceOrientation??{};console.log(m,v,s.deviceOrientation,"位置"),!(!m||!v)&&(t.lookAt(0,0,0),t.position.x=-v/90,t.position.y=m/90,t.position.z=1-.5*Math.min(Math.abs(t.position.x)+Math.abs(t.position.y),1),d.render(o,t))}p()},X=s=>new Promise(async(n,o)=>{console.log("开始打开摄像头");const t=await navigator.mediaDevices.getUserMedia({video:{width:500,height:400,facingMode:"environment"}});if(t)if(!s)o(new Error("not find el"));else{let a=s;a.srcObject=t,console.log(a.srcObject),a.play(),console.log("开始播放")}else alert("摄像头开启失败")}),Y={id:"container"},Z={width:"500",height:"400",muted:"",playsinline:"",controls:!1,"webkit-playsinline":"","x5-video-player-type":"",autoplay:""},I=y("div",{id:"box"},null,-1),K=M({__name:"Model",setup(s){return D(async()=>{await U()}),(n,o)=>(_(),x("div",Y,[S(y("video",Z,null,512),[[R,!1]]),I]))}});export{K as default};
